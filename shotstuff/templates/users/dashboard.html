{% extends 'base.html' %} {% block content %}

<section class="container">
  <h1 class="title">{{ current_user.first_name }}'s Dashboard</h1>
  <div class="row">
    <div class="col-12 col-sm-4 col-md-4 dash-item">
      <h3>
        <b>Overview</b>
      </h3>
      <p>
        You're currently on {{ current_user.active_treatments|length }} active
        treatments.
      </p>
      {% for t in current_user.active_treatments %}
      <li class="list-group-item">
        <a href="/treatments/{{ t.id }}">
          <h5>
            {{ t.medication_regimen.title }}
          </h5>
        </a>
        <p>
          Frequency: every {{ t.frequency_in_seconds / 86400 }} days
          <br/>
          Route: {{ t.medication_regimen.route }}
        </p>
      </li>
      {% endfor %}
    </div>
    <div class="col-12 col-sm-4 col-md-4 dash-item">
      <h3>
        <b>Upcoming Injections</b>
        <i class="fa-solid fa-syringe"></i>
      </h3>
      <p>
        You have {{ current_user.upcoming_injection_times|length }} upcoming
        injections.
      </p>
      {% for inj in current_user.upcoming_injection_times %}
      <li class="list-group-item">
        {% if inj.treatment.last_injection_details.injection.notes %}
        <p>
          <b>Notes from last injection:</b>
          {{ inj.treatment.last_injection_details.injection.notes }}
        </p>
        <hr/>
        {% endif %}
        <p>Due: {{ inj.full_date }}</p>
        <p>Position: {{ inj.treatment.next_injection_detail.position[0] }} side, {{inj.treatment.next_injection_detail.position[1]}} quadrant</p>
        <p>For treatment {{ inj.treatment.medication_regimen.title }}</p>
      </li>
      {% endfor %}
    </div>
    <div class="col-12 col-sm-4 col-md-4 dash-item">
      <h3>
        <b>Upcoming Labs</b>
        <i class="fa-solid fa-vials"></i>
      </h3>
      <p>You have {{ current_user.labs|length }} upcoming labs.</p>
      {% for lab in current_user.labs %}
      <li class="list-group-item">
        <p>Due: {{ lab.treatment.next_lab_due_date }}</p>
        <p>For treatment {{ lab.treatment.medication_regimen.title }}</p>
        Routine? {{ lab.is_routine_lab }}
        <br />
        Requires fasting? {{ lab.requires_fasting }}
        <br/>
        Location: {{ lab.treatment.clinic_supervising }}
      </li>
      {% endfor %}
    </div>
    <div class="col-12 col-sm-12 col-md-12 dash-item">
      <h3><b>Milestones</b></h3>
      <p>You've done {{current_user.injections|length}} total injections!</p>
      <p>{{current_user.on_time_labs}} of routine labs completed on time!</p>
    </div>
  </div>
</section>

{% endblock %}
